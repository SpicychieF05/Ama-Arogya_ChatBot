<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ama Arogya - Analytics Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .language-bars {
            display: flex;
            align-items: end;
            height: 200px;
            gap: 20px;
        }

        .language-bar {
            flex: 1;
            background: #667eea;
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: end;
            justify-content: center;
            color: white;
            font-weight: bold;
            min-height: 30px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>üìä Ama Arogya Analytics Dashboard</h1>
        <p>Public Health Chatbot for Rural Odisha</p>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <h3>Total Interactions</h3>
            <div class="stat-number" id="total-interactions">0</div>
        </div>
        <div class="stat-card">
            <h3>Active Users</h3>
            <div class="stat-number" id="active-users">--</div>
        </div>
        <div class="stat-card">
            <h3>Most Used Language</h3>
            <div class="stat-number" id="top-language">--</div>
        </div>
    </div>

    <div class="chart-container">
        <h3>Language Distribution</h3>
        <div class="language-bars" id="language-chart">
            <!-- Bars will be populated by JavaScript -->
        </div>
    </div>

    <div class="chart-container">
        <h3>Recent Activity</h3>
        <div id="recent-activity">
            <p>Loading recent interactions...</p>
        </div>
    </div>

    <div class="footer">
        <p>¬© 2025 Ama Arogya - AI-Driven Public Health Chatbot</p>
        <p>Built with ‚ù§Ô∏è for Rural Odisha Communities</p>
    </div>

    <script>
        async function fetchStats() {
            try {
                const response = await fetch('/stats');
                const data = await response.json();

                // Update total interactions
                document.getElementById('total-interactions').textContent = data.total_interactions;

                // Update language distribution
                const languageChart = document.getElementById('language-chart');
                const languages = Object.entries(data.language_distribution || {});

                if (languages.length > 0) {
                    const maxCount = Math.max(...languages.map(([_, count]) => count));

                    languageChart.innerHTML = languages.map(([lang, count]) => {
                        const height = maxCount > 0 ? (count / maxCount) * 100 : 0;
                        const langNames = { 'en': 'English', 'hi': 'Hindi', 'or': 'Odia' };
                        return `
                            <div class="language-bar" style="height: ${height}%">
                                ${count}
                            </div>
                        `;
                    }).join('');

                    // Add language labels
                    const labels = languages.map(([lang, _]) => {
                        const langNames = { 'en': 'English', 'hi': 'Hindi', 'or': 'Odia' };
                        return `<div style="text-align: center; margin-top: 10px;">${langNames[lang] || lang}</div>`;
                    }).join('');
                    languageChart.innerHTML += `<div style="display: flex; justify-content: space-around; margin-top: 10px;">${labels}</div>`;

                    // Update top language
                    const topLang = languages.reduce((a, b) => a[1] > b[1] ? a : b);
                    const langNames = { 'en': 'English', 'hi': 'Hindi', 'or': 'Odia' };
                    document.getElementById('top-language').textContent = langNames[topLang[0]] || topLang[0];
                }

            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        // Fetch stats on page load
        fetchStats();

        // Refresh stats every 30 seconds
        setInterval(fetchStats, 30000);
    </script>
</body>

</html>